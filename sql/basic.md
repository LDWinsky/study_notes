# æœ¯è¯­

## æ•°æ®åº“

å…¨éƒ¨è¡¨çš„é›†åˆå®¹å™¨

## è¡¨

æ ¹æ®ä¸€å®šç±»æ¯”å…³ç³»ç»„åˆèµ·æ¥çš„è®°å½•

* å°½å¯èƒ½çš„å…³ç³»å•ä¸€ï¼Œæ¯”å¦‚å®¢æˆ·çš„è¡¨æ ¼åªç”¨æ¥è®°å½•å…¶å§“åçš„ä¿¡æ¯ï¼Œä¸è®°å½•å…¶ä½¿ç”¨çš„äº§å“
* è¡¨åå”¯ä¸€æ€§

## åˆ—

è¡¨æ ¼ä¸€åˆ—ï¼Œè®°å½•ä¸€ä¸ªå±æ€§ï¼Œæ¯”å¦‚å®¢æˆ·çš„åå­—ã€‚

* å…¶æ•°æ®ç±»å‹è¦ç›¸åŒã€‚

## è¡Œ

å¸¦è¾¹ä¸€ä¸ªå¯¹è±¡ã€‚

## ä¸»é”®

è¡Œä¸­èƒ½ä»£è¡¨è‡ªèº«çš„è¯†åˆ«ç¬¦ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå±æ€§ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªå±æ€§çš„ç»„åˆã€‚

* å”¯ä¸€æ€§
* å¿…é¡»æ€§

## SQL

ä¸€ä¸ªæ“ä½œæ•°æ®çš„è¯­æ³•ã€‚å¼€å‘è€…ğŸ‚ğŸº

* ç‰¹æ€§ï¼šç®€å•ï¼ŒåŠŸèƒ½å¼ºï¼Œå¤šå¹³å°æ”¯æŒ

# MYSQL

ä¸€ä¸ªç®¡ç†æ•°æ®çš„åº“çš„è½¯ä»¶ã€‚

## å®‰è£…ï¼ˆIn MACï¼‰

https://dev.mysql.com/doc/refman/8.0/en/osx-installation-pkg.html

## æ‰“å¼€ Mysql Client

/usr/local/mysql/bin/mysql -u root -p
è¾“å…¥ MYSQL å¯†ç 

## å¼•å…¥æµ‹è¯•ç”¨è¡¨

`å¼•å…¥æ•°æ®ï¼Œæ–¹ä¾¿å­¦ä¹ ä½¿ç”¨`

[æµ‹è¯•ç”¨è¡¨](https://forta.com/wp-content/uploads/books/0672327120/mysql_scripts.zip)

```sql

create database crashcourse;

use crashcourse;

source ~/[filepath]/create.sql

source ~/[filepath]/populate.sql

```

# SQL è¯­æ³•

## åŸºç¡€æŸ¥è¯¢ 

### select from

è¯­æ³•: select col_name_in_table from table

åœ¨ table ä¸­é€‰æ‹© col_name åˆ—çš„æ•°æ®;

* æ³¨ï¼šselect åçš„åˆ—åå¯ä»¥æ˜¯å¤šä¸ª select col1,col2 from table;
* DISTINCT å¯ä»¥å•ä¸€åˆ—å‡ºå‡ºç°è¿‡çš„åˆ—åï¼Œä½†æ˜¯ä¸èƒ½ä½¿ç”¨å¤šä¸ªã€‚select distinct col from table;

### order by

å¯¹é€‰å–å‡ºæ¥çš„æ•°æ®è¿›è¡Œæ’åºã€‚

```sql
  select *
  from table
  order by col1 [DESC], col2; // å…ˆæŒ‰ç…§col1è¿›è¡Œæ’åºï¼Œcol1ç›¸åŒå†æŒ‰col2
```

* å¯ä»¥ä½¿ç”¨ DESC æ¥è¿›è¡Œååº

### where

```sql
  select * 
  from table
  where condition
```

condition ä¸ºè¿‡æ»¤çš„æ¡ä»¶

æ•°å­—è¿‡æ»¤å¯é€‰å€¼ï¼š > , <, >=, <=, !=ï¼Œ =

```sql
  select *
  from table
  where age [>| <| != |] 1
```

å­—ç¬¦è¿‡æ»¤å¯é€‰å€¼ï¼š=ï¼Œæ­£åˆ™

= å°±æ˜¯å­—ç¬¦ä¸²å®Œå…¨ç›¸åŒ

æ­£åˆ™åˆ†ä¸ºä¸¤ç±»

å¤§ä¼—è¯­æ³•çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‹¿JSæ¥ç±»æ¯”ï¼ša REGEXP abc === a.match(/abc/);

SQL è¯­æ³•æ­£åˆ™ a % b , a _ b; %: ç­‰ä»·äº .*? , _ ç­‰ä»·äº .;

```sql
    select *
  from table
  where age REGEXP tes{1,4} /* å¯ä»¥åŒ¹é… age === tes111 */
```

èŒƒå›´è¿‡æ»¤å¯é€‰å€¼ï¼š between x and yï¼› key in (x, y)ï¼› key not in (x, y)ï¼›

between 1 and 3; åŒ¹é… 1åˆ°3 çš„å€¼ï¼›
key in (1ï¼Œ 3)ï¼› åŒ¹é… 1 æˆ–è€… 3;
key not in (1, 3); åŒ¹é…ä¸æ˜¯1å’Œ3çš„å€¼ï¼›

ç‰¹åˆ«çš„ a is null; åŒ¹é…aä¸æ˜¯ç©ºçš„è¡Œï¼›

æ‹¼æ¥ç®€å•è¿‡æ»¤æ¡ä»¶ï¼š
ä¸Šé¢çš„ç®€å•è¿‡æ»¤æ¡ä»¶å¯ä»¥ä½¿ç”¨AND æˆ–è€… ORè¿›è¡Œç»„åˆ, å¤šä½¿ç”¨ï¼ˆï¼‰æ¥æ¶ˆé™¤æ­§ä¹‰ï¼›

```sql
  select * from orders
  where (orders.a = 3 AND order.b = 4) OR order.c = 5
```

### è‡ªå®šä¹‰è¿‡æ»¤å‡ºæ¥çš„æ•°æ®è·Ÿé‡å‘½å

å½“æˆ‘ä»¬éœ€è¦å¯¹é€‰å‡ºæ¥çš„æ•°æ®ï¼Œè¿›è¡Œä»å‘½åçš„æ—¶å€™ï¼Œæ¯”å¦‚ select first_name, last_name form customs; ä¼šç”Ÿæˆ [{first_name: 'haha', last_name: 'hehe'}]; ä½†æ˜¯æˆ‘ä»¬åˆèµ·æ¥ç”Ÿæˆ [{name: 'haha hehe'}] çš„ä½¿ç”¨å°±å¯ä»¥ä½¿ç”¨ concat as çš„è¯­æ³•ï¼›

```sql
  select concat(first_name, ' ', last_name) as name
  from customs;
```

### æ±‡æ€»å‡½æ•°

æœ‰æ—¶éœ€è¦å¯¹è·å¾—çš„åˆ—è¿›è¡Œæ±‡æ€»è¿›è¡Œè®¡ç®—ï¼Œæ¯”å¦‚è®¡ç®—ä¸€åˆ—çš„å¹³å‡å€¼ã€‚è¿™æ˜¯å°±éœ€è¦SQLçš„æä¾›çš„æ±‡æ€»ç±»å‡½æ•°ã€‚

```sql
  select avg(price) from orders where custom_id = 'test';
  /* è®¡ç®—å‡º custom_id ä¸º test å…¨éƒ¨åˆ— price çš„å¹³å‡å€¼ */
```

å› ä¸ºä½¿ç”¨äº†æ±‡æ€»å‡½æ•°çš„åŸå›  select åçš„åˆ—å­—æ®µä¸èƒ½å‡ºç°å•ä¸ªçš„åˆ—åï¼Œæ¯”å¦‚ select price, avg(price) ä¼šæŠ¥é”™ï¼›

å…¶ä»–çš„æ±‡æ€»å‡½æ•°å¤§æ¦‚æœ‰ï¼Œ count, max, min, sum ç­‰

### åˆ†ç»„

æœ‰æ—¶å€™æˆ‘ä»¬æƒ³å°†ä¸€ä¸ªè¡¨æ ¼åˆ†ç±»ä¹‹ååœ¨æ±‡æ€»ï¼Œæ¯”å¦‚åƒå¾—åˆ°ç­ä¸Šç”·ç”Ÿå’Œå¥³ç”Ÿçš„å¹³å‡åˆ†è¡¨æ ¼ï¼Œè¿™æ˜¯ç”¨å•ä¸€ä½¿ç”¨æ±‡æ€»å°±ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œè¿™æ—¶å€™å°±å¯ä»¥å…ˆä½¿ç”¨ group by åˆ†ç»„ä¹‹åå†æ±‡æ€»ã€‚

```sql
  select sex, avg(score) from classA group by sex;
```

æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å¯¹åˆ†ç»„åçš„ç»„è¿›è¡Œè¿‡æ»¤ï¼Œæ¯”å¦‚ç­ä¸Šæœ‰ä¸åŒçš„å…´è¶£ç­ï¼Œæˆ‘ä»¬æƒ³åˆ—å‡ºå…´è¶£ç­äººæ•°å¤§äº5çš„ç»„ã€‚è¿™æ—¶å€™ä½¿ç”¨whereæ¥è¿‡æ»¤å¥½åƒå°±ä¸é è°±äº†ã€‚è¿™æ—¶å€™å°±éœ€è¦havingæ¥è¿‡æ»¤ã€‚

```sql
  select club, count(*) from classA group by club having count(*) > 5;
```

### limit

å½“æ•°æ®å‡ºæ¥çš„æ—¶å€™å¯èƒ½æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥ç”¨limitæ¥å»é™¤éƒ¨åˆ†æƒ³è¦çš„è¡Œã€‚æœ€åä½¿ç”¨ limit [startrow,] rowcount;

```sql
  select * from classA limit 0, 3
```

### é¡ºåº

ç›®å‰å·²ç»å°†å¤§éƒ¨åˆ†çš„ç®€å•è¿‡æ»¤è¯­æ³•å­¦å®Œäº†ï¼Œè¿™é‡Œéœ€è¦æ€»ç»“ä¸‹è¯­æ³•å‡ºç°çš„é¡ºåºï¼›

select > from > where > group by > having > order by > limit

æ³¨ï¼šåˆ°è¿™é‡ŒåŸºæœ¬ä¸Šåªåœ¨ä¸€ä¸ªè¡¨ä¸­çš„æ“ä½œåŸºæœ¬å°±å®Œäº†

# å¤šè¡¨æ“ä½œ

## å­æŸ¥è¯¢è¯­å¥

ä¸Šé¢çš„ select ... from è¯­å¥å«åšæ˜¯ä¸€è¡Œqueryï¼› æˆ‘ä»¬å¯ä»¥åœ¨ä¸€è¡Œqueryä¸­æ’å…¥å¦ä¸€è¡Œqueryè¿™ä¸ªå°±å«åšå­æŸ¥è¯¢ï¼›

ä¸€èˆ¬åˆä¸¤ä¸ªç”¨é€”ï¼Œä¸€ä¸ªæ˜¯åœ¨å¦ä¸€ä¸ªè¡¨ä¸­è·å–æ•°æ®ï¼Œç”¨äºå½“å¦ä¸€ä¸ªè¡¨çš„æŸ¥è¯¢æ¡ä»¶ã€‚å¦ä¸€ä¸ªæ˜¯ç”¨å½“å‰è¡¨çš„æ•°æ®å½“åšå¦ä¸€ä¸ªè¡¨çš„æŸ¥è¯¢æ¡ä»¶æ¥æŸ¥è¯¢å®Œå†æ‹¿å›æ¥å½“å½“å‰è¡¨çš„æ–°åˆ—è¾“å‡ºã€‚

```sql
  /* ç”¨é€”ä¸€ï¼š */
  select * from classA
  where parent in (select parent_id from parentTable where parent_id === 'ahole')
  /* æ‰¾å‡ºç­çº§é‡Œçˆ¸çˆ¸æ˜¯aholeçš„å­¦ç”Ÿï¼ŒaholeçœŸèƒ½ç”Ÿå•Š */
```

```sql
  /* ç”¨é€”äºŒ */
  select *, (
    select count(*) from parent
    where classA.parent = parent.id
  ) from classA
```

* æ³¨ï¼šè§‚å¯Ÿå¯å‘ç°å­æŸ¥è¯¢è¾“å‡ºçš„æ ¼å¼è¦ä¹ˆæ˜¯æ•°ç»„è¦ä¹ˆæ˜¯å•ä¸€çš„å€¼

## è¡¨è”ç»“

å…³ç³»å‹æ•°æ®åº“çš„ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ä¸€ä¸ªè¡¨å«æœ‰çš„ä¿¡æ¯ä¼šå°½å¯èƒ½çš„å•ä¸€ï¼Œæ¯”å¦‚äº§å“çš„è¡¨å°±åªä¼šå¯¹äº§å“è¿›è¡Œæè¿°ï¼Œä¸ä¼šå¯¹å…¶äº§å•†è¿›è¡Œç»†èŠ‚æè¿°ï¼Œåªä¼šå¯¹å…¶äº§å•†æä¾›ä¸€ä¸ªidï¼Œå·²å¯¹æ¥äº§å•†è¡¨çš„äº§å•†ã€‚è¿™ä¸ªidå°±æ˜¯*å¤–é”®*ã€‚å¦‚æœæˆ‘ä»¬è¦ç”Ÿæˆä¸€ä¸ªè¡¨æ ¼ï¼Œå¸¦ä¸Šç”Ÿäº§å•†çš„ä¿¡æ¯ï¼Œåªç»™ä¸ªIDï¼Œé¬¼å•ƒå¾—æ‡‚ã€‚è¿™æ—¶å€™å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢ä½†æ˜¯ï¼Œå¤ªæ…¢äº†ã€‚è¿™æ˜¯å°±éœ€è¦*è¡¨è”ç»“*ã€‚

### ç”Ÿæˆè”ç»“è¡¨

```sql
  select * from tableA, tableB
  where tableA.id = tableB.id;
```

* è§£æï¼šwhere table.id = tableB.id; from tableA, tableB; è¿™é‡Œä¼šå°†ä¸¤ä¸ªè¡¨å„è¡Œè¿›è¡Œä¸€ä¸ªç¬›å¡å°”ç§¯ï¼›ç”Ÿæˆ tableA è¡Œ * tableB è¡Œçš„å‡½æ•°ï¼Œè€Œä¸”å¤§éƒ¨åˆ†éƒ½ä¸æ˜¯æˆ‘ä»¬è¦çš„ï¼Œè¿™é‡Œä½¿ç”¨ table.id = tableB.id æ¥è¿‡æ»¤å°±èƒ½ç”Ÿæˆä¸¤ä¸ªè¡¨ä¸­ç›¸åŒ id çš„è¡Œï¼Œå½¢æˆä¸¤ä¸ªè¡¨å¯¹åº”ä¿¡æ¯çš„è”ç»“

### ä¸åŒçš„è”ç»“æ–¹å¼

è‡ªè”ç»“ï¼šè¡¨è·Ÿè‡ªèº«è”ç»“ã€‚
ä¸€èˆ¬ç”¨äºé€šè¿‡ä¸€ä¸ªcolè·å–é‚£ä¸€è¡Œçš„å¦ä¸€ä¸ªå±æ€§ï¼Œç„¶ååœ¨é€šè¿‡è¿™ä¸ªå±æ€§æ¥è·å–ç›¸åŒçš„è¡Œã€‚å¦‚ï¼šæˆ‘ä»¬å‘ç°ä¸€ä¸ªå‘˜å·¥è€æ˜¯æ‘¸é±¼ï¼Œæˆ‘ä»¬æƒ³çŸ¥é“è·Ÿè¿™ä¸ªå‘˜å·¥ä¸€æ ·æ¥è‡ªå’¸é±¼é•‡çš„å‘˜å·¥æ˜¯ä¸æ˜¯ä¹Ÿè€å¸ˆæ‘¸é±¼ã€‚

å¤–éƒ¨è”ç»“ï¼š
ä¸€èˆ¬åœºæ™¯æˆ‘ä»¬ä½¿ç”¨æ™®é€šçš„è”ç»“å°±èƒ½å¾—åˆ°æƒ³è¦çš„ç»“æœï¼Œæ¯”å¦‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¡¨ï¼Œä¸€ä¸ªè®°å½•äº§å“çš„é”€é‡ï¼Œå¦ä¸€ä¸ªè®°å½•å…¶äº§å•†ï¼Œæˆ‘ä»¬æƒ³çš„åˆ°ä¸€ä¸ªäº§å“é”€é‡è·Ÿå…¶äº§å•†çš„è”ç»“è¡¨ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬çš„é”€é‡æƒ¨æ·¡ï¼Œåªæœ‰ä¸€ä¸ªäº§å“å–å‡ºå»ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç”¨æ™®é€šçš„è”ç»“å°±ä¼šå‡ºç°ï¼Œåªæœ‰ä¸€è¡Œçš„æƒ…å†µã€‚å¦‚æœæˆ‘ä»¬æƒ³æŠŠæ²¡æœ‰é”€é‡çš„äº§å“ä¹Ÿåˆ—å‡ºæ¥å‘¢ï¼Ÿå°±éœ€è¦å¤–éƒ¨è”ç»“`outer join on`å•¦ ã€‚

```sql
  select * from order right outer join vendor on order.prod_id = vender.prod_id;
```

* left or right ; ç¿»è¯‘ä¸ºå“ªè¾¹åŠ å…¥å“ªè¾¹ï¼Œleft å°±æ˜¯å·¦è¾¹åŠ å…¥ã€‚å³è¾¹è¡¨æ ¼æ•°æ®åŠ å…¥å·¦è¾¹æ•°æ®ï¼Œå·¦è¾¹å‡ºç°æ²¡æœ‰è¢«åŒ¹é…åˆ°çš„å°±æŠŠå€¼å¡«ä¸ºNullï¼›

## å…¨æ–‡æœç´¢

å…¨æ–‡æœç´¢è§†ä¸ºäº†å¼¥è¡¥æˆ‘ä»¬è‡ªå·±å†™æ­£åˆ™é‡åˆ°çš„é—®é¢˜ã€‚ä¸€ï¼Œå¤ªéš¾å†™ã€‚äºŒï¼Œæ€§èƒ½å·®ã€‚ä¸‰ï¼Œä¸èƒ½æ ¹æ®åŒ¹é…ç¨‹åº¦è¿”å›ã€‚ï¼ˆåªæœ‰æœ¬æ•°æ®è¡¨æ ¼å¼æ”¯æŒå…¨æ–‡æœç´¢ã€‚æ¯”å¦‚MyISAMï¼‰

ä¸ºäº†ä½¿ç”¨å…¨æ–‡æœç´¢éœ€è¦åœ¨å»ºç«‹è¡¨çš„æ—¶å€™æŒ‡æ˜é‚£ä¸ªå­—æ®µæ”¯æŒã€‚

```sql
  create table full_text_example (
    note_id init not null, auto_increment,
    note_text text null,
    primary key(note_id),
    FULLTEXT(note_text)
  ) engine=MyISAM;
```

### match against

```sql
  select * from full_text_example
  where match(note_text) against('rabbit');
```

è¯¥ query å°±ä¼šè¿”å›å¸¦æœ‰rabbitçš„è¡Œäº†ï¼ˆæ ¹æ®åŒ¹é…æ¯”é‡æ’åºï¼‰ã€‚

* åˆ°è¿™é‡ŒæŸ¥è¯¢çš„éƒ½å·²ç»æå®Œäº†ğŸ˜†ã€‚

## å¯¹è¡¨è¿›è¡Œå¢åˆ æŸ¥æ”¹

### åˆ›å»º

* åˆ›å»ºæ ¼å¼å¦‚ä¸‹

```sql
  create table tableName (
    col_name type (not Null | Null) default defaultValue [auto_increment],
    col_name type (not Null | Null) default defaultValue [auto_increment],
    primary key (col_name),
    [FULLTEXT]
  ) ENGINE=(MyISAM, InnoDB, MEMORY)
```

ENGINE.memory ä¼šæŠŠæ•°æ®æ”¾åœ¨å†…å­˜ä¸­ã€‚

### æ·»åŠ åˆ—

```sql
  ALERT Table table_name ADD new_col_name type;
```

### æ·»åŠ å¤–é”®

```sql
  alert table table_name add constraint fk_name foreign key (col) references table (col)
```

### åˆ é™¤è¡¨

```sql
  drop table table_name;
```

### é‡å‘½å

```
  rename table table_name to new_table_name
```

### æ’å…¥è¡Œ

```sql
  insert into table_name (
    columns,
    columns,
    columns,
    columns,
  ) values (
    value,
    value,
    value,
    value,
  ), (
    value,
    value,
    value,
    value,
  )
```

```sql
  insert into table_name (
    columns,
    columns,
    columns,
    columns,
  ) select columns, columns,columns,columns from table_name2
```

### æ›´æ”¹è¡Œ

```sql
  update table_name
  set columns = 'new date'
  where columns = 'old date'
```

### åˆ é™¤è¡Œ

```sql
  delete from table_name
  where columns = 'new date'
```

## è§†å›¾

ç”¨äºä¿å­˜queryçš„æ–¹æ³•ï¼Œå½“æˆ‘ä»¬æœ‰ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„queryçš„æ—¶å€™ï¼Œä¸æƒ³æ¯æ¬¡éƒ½é‡æ–°å†™çš„å°±å¯ä»¥ä¿å­˜èµ·æ¥å½“æˆä¸€ä¸ªtableå»ç”¨ã€‚å¯ä»¥è·Ÿæ–°ä½†æ˜¯ä¸å»ºè®®ã€‚

```sql
  create view view_name as select * from query where query.id = 33
```
